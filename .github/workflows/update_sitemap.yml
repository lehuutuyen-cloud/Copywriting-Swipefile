name: Update Sitemap & Index

on:
  push:
    branches: [ main, master ]
    paths:
      - 'books/**'   # Chá»‰ cháº¡y khi cÃ³ thay Ä‘á»•i trong thÆ° má»¥c books
  workflow_dispatch: # Cho phÃ©p báº¥m cháº¡y thá»§ cÃ´ng

# Cáº¤P QUYá»€N GHI (QUAN TRá»ŒNG)
permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    # 1. NÃ¢ng cáº¥p checkout lÃªn v4 (Má»›i nháº¥t)
    - name: Checkout repo
      uses: actions/checkout@v4
      with:
        fetch-depth: 0 # Láº¥y toÃ n bá»™ lá»‹ch sá»­ Ä‘á»ƒ check ngÃ y thÃ¡ng chuáº©n hÆ¡n

    # 2. NÃ¢ng cáº¥p Python setup lÃªn v5
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'

    # 3. Cháº¡y script táº¡o index (Cá»— mÃ¡y phÃ¢n loáº¡i)
    - name: Run Index Generator
      run: |
        python scripts/generate_index.py

    # 4. Cam káº¿t thay Ä‘á»•i (Commit changes)
    - name: Commit and Push changes
      uses: stefanzweifel/git-auto-commit-action@v5
      with:
        commit_message: "ðŸ¤– AUTO: Update Library Index & Sitemap"
        file_pattern: 'index.json README.md books/**/metadata.json'
