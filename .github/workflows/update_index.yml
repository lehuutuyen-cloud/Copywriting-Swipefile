name: Update Library Index

on:
  push:
    paths:
      - 'books/**' # Chá»‰ cháº¡y khi cÃ³ thay Ä‘á»•i trong thÆ° má»¥c books

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    
    - name: Generate Index JSON
      run: |
        echo "[" > index.json
        FIRST=1
        # Duyá»‡t qua cÃ¡c folder trong books/
        for d in books/*/; do
            if [ -f "${d}metadata.json" ]; then
                if [ $FIRST -eq 0 ]; then echo "," >> index.json; fi
                
                # Láº¥y ná»™i dung metadata
                cat "${d}metadata.json" >> index.json
                
                # ThÃªm danh sÃ¡ch cÃ¡c chÆ°Æ¡ng vÃ o JSON (Optional - nÃ¢ng cao)
                # á»ž má»©c cÆ¡ báº£n, chÃºng ta chá»‰ cáº§n list cÃ¡c sÃ¡ch cÃ³ sáºµn
                FIRST=0
            fi
        done
        echo "]" >> index.json
        
        # Format láº¡i JSON cho Ä‘áº¹p (náº¿u cáº§n)
        # python3 -m json.tool index.json > index_formatted.json && mv index_formatted.json index.json

    - name: Commit and Push changes
      run: |
        git config --global user.name 'GitHub Action'
        git config --global user.email 'action@github.com'
        git add index.json
        git diff --quiet && git diff --staged --quiet || (git commit -m "ðŸ¤– Auto-update library index" && git push)
